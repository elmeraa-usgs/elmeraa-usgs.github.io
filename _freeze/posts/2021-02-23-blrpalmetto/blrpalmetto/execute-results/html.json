{
  "hash": "5326b72c036a1c3a695de76c5660928c",
  "result": {
    "markdown": "---\ntitle: \"Binary Logistic Regression\"\ndescription: |\n  Binary logistic regression of two dominant Palmetto species of south-central Florida from 1981 - 2017.\nauthor:\n  - name: Elmera Azadpour\ndate: 2021-02-23\nformat: html\ncategories: [code, analysis, binary logistic regression]\nimage: \"palmetto.jpg\"\n---\n\n\n### To access data, html and Rmd files:\n\n-   https://github.com/elmeraa/244-assignment2\n-   you will find palmetto data in the \"data\" folder\n-   you will find the Rmd and html files as \"a2-task2\" in the \"src\" folder\n\n## Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(GGally)\nlibrary(broom)\nlibrary(jtools)\nlibrary(kableExtra)\n```\n:::\n\n\n## Read in data {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalmetto <- read_csv(here(\"posts\", \"2021-02-23-blrpalmetto\", \"palmetto.csv\"), \n                     col_types = cols(.default = \"c\")) %>%\n  mutate(height = as.numeric(height)) %>% \n  mutate(species_name = case_when(\n    species == 1 ~ \"Serenoa repens\", \n    species == 2 ~ \"Sabal etonia\")) %>% \n  mutate(site_name = case_when(\n    site == 1 ~ \"Copse Road\", \n    site == 2 ~ \"Ridge Road\",\n    site == 3 ~ \"WSP2\",\n    site == 4 ~ \"WS30\",\n    site == 5 ~ \"WSP1\",\n    site == 6 ~ \"Red Hill\"))  %>% \n  mutate(width = as.integer(width)) %>% \n  mutate(length = as.integer(length)) %>% \n  mutate(green_lvs = as.integer(green_lvs))\n```\n:::\n\n\n## Data exploration between species 1 (*Serenoa* repens) and species 2 (*Sabal* etonia). {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(palmetto,\n       aes(x = species_name, y = height)) +\n  geom_boxplot(aes(fill = species_name)) +\n  facet_wrap(~ site_name) +\n  labs(x = \"Species\", y = \"Canopy height (cm)\") +\n  scale_fill_discrete(name = \"Species\") +\n  theme_light() +\n theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![**Figure 1**. Species (Sabal etonia and Sernoa repens) vs canopy height (cm) by study site. Generally Sabal etonia tends to have higher canopy height than Serenoa repens across the sites.](blrpalmetto_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Graph 2 {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(palmetto, aes(x = width, y = length)) +\n  geom_point(aes(color = species_name)) +\n  theme_minimal() +\n  labs(x = \"Canopy width (cm)\", y = \"Canopy height (cm)\") +\n  scale_color_discrete(name = \"Species\") +\n theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![**Figure 2**. Canopy width (cm) vs canopy height (cm) for both species (Sabal etonia and Serenoa repens). Trend indicates Sabal etonia trees tend to have more lower capopy width and higher canopy height as compared to Serenoa repens, however still lots of spread in the data.](blrpalmetto_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Binary logistic regression using plant height, canopy length, canopy width and green leaves as predictor variables to understand how they relate to probability of a plant being Serenoa repens or Sabal etonia {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalmetto_blr_ds <- palmetto %>% \n  mutate(species_name = fct_drop(species_name)) %>% \n  select(species_name, height, length, width, green_lvs) \n  \npalmetto_blr <- glm(species_name ~ height + length + width + green_lvs ,\n                            data = palmetto_blr_ds, \n                            family = \"binomial\")\n```\n:::\n\n\n## Look at outcome of blr model {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalmetto_blr #\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:  glm(formula = species_name ~ height + length + width + green_lvs, \n    family = \"binomial\", data = palmetto_blr_ds)\n\nCoefficients:\n(Intercept)       height       length        width    green_lvs  \n   -3.09204      0.02930     -0.04571     -0.03927      1.89280  \n\nDegrees of Freedom: 12266 Total (i.e. Null);  12262 Residual\n  (193 observations deleted due to missingness)\nNull Deviance:\t    17010 \nResidual Deviance: 5166 \tAIC: 5176\n```\n:::\n\n```{.r .cell-code}\nsummary(palmetto_blr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = species_name ~ height + length + width + green_lvs, \n    family = \"binomial\", data = palmetto_blr_ds)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-4.7821  -0.2637  -0.0055   0.1715   3.3631  \n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -3.092041   0.141270  -21.89   <2e-16 ***\nheight       0.029304   0.002311   12.68   <2e-16 ***\nlength      -0.045713   0.001872  -24.41   <2e-16 ***\nwidth       -0.039266   0.002102  -18.68   <2e-16 ***\ngreen_lvs    1.892804   0.038591   49.05   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 17005.5  on 12266  degrees of freedom\nResidual deviance:  5166.1  on 12262  degrees of freedom\n  (193 observations deleted due to missingness)\nAIC: 5176.1\n\nNumber of Fisher Scoring iterations: 7\n```\n:::\n\n```{.r .cell-code}\n# We can use the broom::tidy() function to get the model outputs in nice data frame format:\npalmetto_blr_tidy <- broom::tidy(palmetto_blr)\n\n# Get the intercept: \npalmetto_int <- palmetto_blr_tidy$estimate[1]\npalmetto_int\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -3.092041\n```\n:::\n\n```{.r .cell-code}\n# Then to get the  coefficient:\npalmetto_coef <- palmetto_blr_tidy$estimate[2]\npalmetto_coef\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.02930385\n```\n:::\n\n```{.r .cell-code}\n#What about getting some other model information (degrees of freedom, F-statistic, p-value, etc.)?\n#Many of these statistical outcomes can be accessed more easily using broom::glance().\n# Metrics at a glance: \npalmetto_lm_out <- broom::glance(palmetto_blr)\npalmetto_lm_out\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 Ã— 8\n  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs\n          <dbl>   <int>  <dbl> <dbl> <dbl>    <dbl>       <int> <int>\n1        17006.   12266 -2583. 5176. 5213.    5166.       12262 12267\n```\n:::\n\n```{.r .cell-code}\n## tidy model table output\npalmetto_blr_tidy %>% \n  kable(col.names = c(\"Term\",\n                      \"Estimate\",\n                      \"St Error\",\n                      \"t-statistic\",\n                      \"p-value\")) %>% \n  kable_styling(full_width = FALSE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> St Error </th>\n   <th style=\"text-align:right;\"> t-statistic </th>\n   <th style=\"text-align:right;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -3.0920409 </td>\n   <td style=\"text-align:right;\"> 0.1412703 </td>\n   <td style=\"text-align:right;\"> -21.88740 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> height </td>\n   <td style=\"text-align:right;\"> 0.0293039 </td>\n   <td style=\"text-align:right;\"> 0.0023114 </td>\n   <td style=\"text-align:right;\"> 12.67770 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> length </td>\n   <td style=\"text-align:right;\"> -0.0457129 </td>\n   <td style=\"text-align:right;\"> 0.0018724 </td>\n   <td style=\"text-align:right;\"> -24.41353 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> width </td>\n   <td style=\"text-align:right;\"> -0.0392659 </td>\n   <td style=\"text-align:right;\"> 0.0021022 </td>\n   <td style=\"text-align:right;\"> -18.67885 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> green_lvs </td>\n   <td style=\"text-align:right;\"> 1.8928041 </td>\n   <td style=\"text-align:right;\"> 0.0385905 </td>\n   <td style=\"text-align:right;\"> 49.04843 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n-   What does model output tell us? Output tells us that probabiliy of *Serenoa* repens species because its \"1\" in the levels. So we expect on average, that as canopy height increases, the odds of the species being *Serenoa* repens increases. With an increase in canopy length, the odds of the species being *Serenoa* repens decreases on average. Similarly with width, we expect that as canopy width increases, the odds of the species being *Serenoa* repens decreases. Lastly, on average as count of green leaves increases, we expect the odds of the species being *Serenoa* repens increases.\n\n## Evaluates how successfully this model would \"classify\" a plant as the correct species, using a 50% cutoff (e.g. if the probability is \\>=50% that it is species A, then it would be classified as species A) {.tabset}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalmetto_blr_fitted <- palmetto_blr %>% \n  broom::augment(type.predict = \"response\") %>% \n  mutate(classification = case_when(.fitted >=0.50 ~ \"Serenoa repens\", \n      TRUE ~ \"Sabal etonia\")) \n  \n\npalmetto_table <- palmetto_blr_fitted %>% \n  select(species_name, .fitted, classification) %>% \n  mutate(correct = case_when(\n      species_name == \"Serenoa repens\" & classification == \"Serenoa repens\" ~ \"correct\",\n      species_name == \"Sabal etonia\" & classification == \"Sabal etonia\" ~ \"correct\",\n      TRUE ~ \"incorrect\"))\n  \n  \npalmetto_summary_table <- palmetto_table %>% \n  group_by(species_name, correct) %>% \n  summarise(count = n()) %>% \n  mutate(percentcorrect = (count / sum(count)*100))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'species_name'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\npalmetto_summary_table %>%  \n  kable(col.names = c(\"Species name\",\n                      \"Correct or incorrect model classification?\",\n                      \"Count\",\n                      \"% Correctly classified\"), \n        caption = \"**Table 1**: summary statistics binary logistic regression analysis on palmetto dataset including species: Serenoa repens & Sabal etonia (data source: Abrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year)\") %>% \n  kable_styling(full_width = FALSE) \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>**Table 1**: summary statistics binary logistic regression analysis on palmetto dataset including species: Serenoa repens &amp; Sabal etonia (data source: Abrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Species name </th>\n   <th style=\"text-align:left;\"> Correct or incorrect model classification? </th>\n   <th style=\"text-align:right;\"> Count </th>\n   <th style=\"text-align:right;\"> % Correctly classified </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Sabal etonia </td>\n   <td style=\"text-align:left;\"> correct </td>\n   <td style=\"text-align:right;\"> 5688 </td>\n   <td style=\"text-align:right;\"> 92.412673 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sabal etonia </td>\n   <td style=\"text-align:left;\"> incorrect </td>\n   <td style=\"text-align:right;\"> 467 </td>\n   <td style=\"text-align:right;\"> 7.587327 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Serenoa repens </td>\n   <td style=\"text-align:left;\"> correct </td>\n   <td style=\"text-align:right;\"> 5541 </td>\n   <td style=\"text-align:right;\"> 90.657723 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Serenoa repens </td>\n   <td style=\"text-align:left;\"> incorrect </td>\n   <td style=\"text-align:right;\"> 571 </td>\n   <td style=\"text-align:right;\"> 9.342277 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "blrpalmetto_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}