{
  "hash": "bb4a355399740aeea46a33d8b333bffa",
  "result": {
    "markdown": "---\ntitle: \"Hierarchical Clustering\"\ndescription: |\n  Hierarchical clustering by complete linkage to create a dendrogram showing multivariate clustering for water chemistry by site in Santa Barbara, CA.\nauthor:\n  - name: Elmera Azadpour\ndate: 2021-03-07\nformat: html\ncategories: [code, analysis, hierarchical-clustering]\nimage: \"clustering.jpg\"\n---\n\n\n### To access data, html and Rmd/qmd files:\n-   the stream chemistry data can be found in the *data* folder of [this repo](https://github.com/elmeraa/244-assignment4); the Rmd and html files, denoted as *a4-task1*, can be found in the *src* folder\n-   the qmd format can be found [here](https://github.com/elmeraa/elmeraa.github.io/tree/main/posts/2021-03-07-hierarchical-clustering)\n\n\n## Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\n# Packages for cluster analysis:\nlibrary(NbClust)\nlibrary(cluster)\nlibrary(factoextra)\nlibrary(dendextend)\nlibrary(ggdendro)\n```\n:::\n\n\n### Introduction:\n\n-   To perform hierarchical clustering by site, we'll begin by making a data frame that has a single summary row per site (e.g. based on means from all observations at that site), then we will calculate the euclidean distance before performing complete linkage agglomerative hierarchical clustering.\n\n### Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstream_chem <- read_csv(here(\"posts\", \"2021-03-07-hierarchical-clustering\",\"sbc_lter_registered_stream_chemistry.csv\")) %>% \n  clean_names() %>% \n  na_if(-999.0) %>% \n  group_by(site_code) %>% \n  summarise(across(nh4_u_m:spec_cond_u_spercm, mean, na.rm = TRUE)) %>% \n  drop_na()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 19390 Columns: 12\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr   (1): site_code\ndbl  (10): nh4_uM, no3_uM, po4_uM, tdn_uM, tdp_uM, tpc_uM, tpn_uM, tpp_uM, t...\ndttm  (1): timestamp_local\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n### Scale the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# scale the numeric variables\nstream_chem_scaled <- stream_chem %>% \n  dplyr::select(2:11) %>% \n  scale()\n\n# make rownames the site code names from original data set\nrownames(stream_chem_scaled) <- stream_chem$site_code\n\n# Compute dissimilarity values (Euclidean distances):\nstream_euc_distance <- dist(stream_chem_scaled, method = \"euclidean\")\n\n# Check out the output:\n# View(euc_distance)\n```\n:::\n\n\n### Perform hierarchical clustering by complete linkage with `stats::hclust()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Hierarchical clustering (complete linkage)\nstream_hc_complete <- hclust(stream_euc_distance, method = \"complete\" )\n\n# Plot it (base plot):\nplot(stream_hc_complete, cex = 0.6, hang = -1)\n```\n\n::: {.cell-output-display}\n![](hierarchical-clustering_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Convert to class: dendogram\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstream_dend_complete <- as.dendrogram(stream_hc_complete)\n```\n:::\n\n\n### Plot using `ggdendrogram()`, a `ggplot` wrapper:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ggplot \nggdendrogram(stream_dend_complete, \n             rotate = TRUE)+\n  labs(x = \"Santa Barbara area watershed site code\") +\n  ylab(NULL)+ \n  theme_bw() + \n  theme(panel.border = element_blank(), panel.grid.major = element_blank(),\npanel.grid.minor = element_blank(), axis.line = element_line(colour = \"black\")) \n```\n\n::: {.cell-output-display}\n![](hierarchical-clustering_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Data & Metadata Source:\n\n-   SBC LTER: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 Creators: Santa Barbara Coastal LTER, & Melack, John M Citation: Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. Environmental Data Initiative. https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174.\n",
    "supporting": [
      "hierarchical-clustering_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}