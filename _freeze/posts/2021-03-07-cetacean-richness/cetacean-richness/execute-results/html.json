{
  "hash": "37933d829533723395fbc804d7f8ea11",
  "result": {
    "markdown": "---\ntitle: \"Species Richness of Cetaceans along Coastal California\"\ndescription: |\n  Raster of species richness of cetacean species off the coast of California utlizing a probability threshold.\nauthor:\n  - name: Elmera Azadpour\ndate: 2021-03-07\nformat: html\ncategories: [code, analysis, raster]\nimage: \"cetacean.jpg\"\n---\n\n\n### To access data, html and Rmd/qmd files:\n\n-   the cetacean data can be found in the *data* folder of [this repo](https://github.com/elmeraa/244-Assignment3); the Rmd and html files, denoted as *a3-task2*, can be found in the *src* folder\n-   the qmd format can be found [here](https://github.com/elmeraa/elmeraa.github.io/tree/main/posts/2021-03-07-cetacean-richness)\n\n### Load Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6     ✔ purrr   0.3.4\n✔ tibble  3.1.8     ✔ dplyr   1.0.9\n✔ tidyr   1.2.0     ✔ stringr 1.4.0\n✔ readr   2.1.2     ✔ forcats 0.5.1\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /Users/elmeraa/Desktop/elmera/elmera\n```\n:::\n\n```{.r .cell-code}\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(raster)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: sp\n\nAttaching package: 'raster'\n\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n```{.r .cell-code}\nlibrary(fasterize)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'fasterize'\n\nThe following object is masked from 'package:graphics':\n\n    plot\n\nThe following object is masked from 'package:base':\n\n    plot\n```\n:::\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(rgeos)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nrgeos version: 0.5-9, (SVN revision 684)\n GEOS runtime version: 3.10.2-CAPI-1.16.0 \n Please note that rgeos will be retired by the end of 2023,\nplan transition to sf functions using GEOS at your earliest convenience.\n GEOS using OverlayNG\n Linking to sp version: 1.4-7 \n Polygon checking: TRUE \n```\n:::\n:::\n\n\n### Read in data and stack files\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncetacean <-  list.files(here(\"posts\", \"2021-03-07-cetacean-richness\",\"ca_cetaceans\"), full.names = TRUE)\ncetacean_raster <- stack(cetacean)\ncetacean_raster\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass      : RasterStack \ndimensions : 12, 20, 240, 35  (nrow, ncol, ncell, nlayers)\nresolution : 0.5, 0.5  (x, y)\nextent     : -125, -115, 32, 38  (xmin, xmax, ymin, ymax)\ncrs        : +proj=longlat +datum=WGS84 +no_defs \nnames      : Balaenoptera_acutorostrata, Balaenoptera_borealis, Balaenoptera_brydei, Balaenoptera_edeni, Balaenoptera_musculus, Balaenoptera_physalus, Berardius_bairdii, Delphinus_capensis, Delphinus_delphis, Eschrichtius_robustus, Eubalaena_japonica, Globicephala_macrorhynchus, Grampus_griseus, Indopacetus_pacificus, Kogia_breviceps, ... \nmin values :                       0.11,                  0.02,                0.03,               0.03,                  0.01,                  0.06,              0.01,               0.03,              0.03,                  0.11,               0.59,                       0.02,            0.03,                  0.01,            0.03, ... \nmax values :                       1.00,                  1.00,                1.00,               1.00,                  1.00,                  1.00,              1.00,               0.63,              1.00,                  1.00,               1.00,                       1.00,            1.00,                  0.47,            1.00, ... \n```\n:::\n\n```{.r .cell-code}\nplot(cetacean_raster)\n```\n\n::: {.cell-output-display}\n![](cetacean-richness_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### Apply probability threshold (of 0.6 or greater) to determine presence or non-presence\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquamap_fun <- function(x, thresh = 0.6){\n  y <- ifelse(x >= thresh, 1, 0)\n  return(y)\n}\n\naquamap <- calc(cetacean_raster, fun = aquamap_fun)\nspecies_richness1 <- calc(aquamap, fun = sum, na.rm = TRUE)\nplot(species_richness1)\n```\n\n::: {.cell-output-display}\n![](cetacean-richness_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Converting to dataframe and plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquamap_df <- raster::rasterToPoints(species_richness1) %>% \n  as.data.frame()\n\nstates110 <- ne_download(scale = 110, type = 'states', category = 'cultural', returnclass = \"sf\") %>% filter(name %in% c(\"California\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in check_data_exist(scale = scale, category = category, type = type):\nyour combination of type, category, scale seem not to exist in the list of\nNatural Earth data so you may get a download fail message. Check ?ne_download or\nhttp://www.naturalearthdata.com/features/ to see data availability.\n\nWarning in check_data_exist(scale = scale, category = category, type = type):\nyour combination of type, category, scale seem not to exist in the list of\nNatural Earth data so you may get a download fail message. Check ?ne_download or\nhttp://www.naturalearthdata.com/features/ to see data availability.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nOGR data source with driver: ESRI Shapefile \nSource: \"/private/var/folders/r0/gbtncpg92w3chydzw5fw5bnr0000gn/T/Rtmp0dFxl2\", layer: \"ne_110m_admin_1_states_provinces_lakes\"\nwith 51 features\nIt has 121 fields\nInteger64 fields read as strings:  ne_id \n```\n:::\n\n```{.r .cell-code}\nggplot() +\ngeom_raster(data = aquamap_df, aes(x=x,y=y, fill = layer)) +\n  geom_sf(data = states110) +\n  scale_fill_gradient2(low = \"red\", mid = \"white\", high = \"blue\") +\n  labs(x = \"Longitude\", y = \"Latitude\", title = \"Species Richness of Cetaceans along Coastal California\", fill = \"Number of Cetacean Species\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![**Fig. 1** Species Richness of 16 Cetacean Species along the Coast of California. Presence of Cetacean species was determined with with a probability threshold of 0.6 or greater.](cetacean-richness_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Citation:\n\n-   Kaschner, K., Rius-Barile, J., Kesner-Reyes, K., Garilao, C., Kullander, S., Rees, T., & Froese, R. (2016). AquaMaps: Predicted range maps for aquatic species. www.aquamaps.org\n",
    "supporting": [
      "cetacean-richness_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}