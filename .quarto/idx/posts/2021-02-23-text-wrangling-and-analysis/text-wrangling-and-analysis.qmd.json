{"title":"Text wrangling and analysis","markdown":{"yaml":{"title":"Text wrangling and analysis","description":"Counts and visualizations for the most frequently used words in \"The Origin of Species\" by Charles Darwin, 6th Edition.\n","author":[{"name":"Elmera Azadpour"}],"date":"2021-02-23","format":"html","categories":["code","text analysis","visualization"],"image":"wordcloud.jpg"},"headingText":"About","containsRefs":false,"markdown":"\n\n\nThis blog post conducts a text mining and NRC sentiment analysis using text from \"The Origin of Species\" by Charles Darwin, 6th Edition.\n\nTo access data, html and Rmd/qmd files:\n\n-   the Origin of Species pdf can be found in the data folder [here](https://github.com/elmeraa/244-Assignment3); the Rmd and html files, denoted as a3-task3, can be found in the src folder\n\n-   the qmd format can be found [here](https://github.com/elmeraa/elmeraa.github.io/tree/main/posts/2021-02-23-text-wrangling-and-analysis)\n\n### Load packages\n\n```{r setup, message = FALSE}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(tidytext)\nlibrary(textdata)\nlibrary(pdftools)\nlibrary(ggwordcloud)\n```\n\n### Read in the Origin of Species, 6th Edition by Darwin\n\n```{r, warning=FALSE}\nos_text <- pdf_text(here(\"posts\", \"2021-02-23-text-wrangling-and-analysis\", \"originofspecies6th-darwin.pdf\"))\n```\n\n### Text into a data frame, then wrangling with the `tidyverse`, break it up by chapter, and do some basic analyses.\n\n```{r, warning=FALSE}\nos_tidy <- data.frame(os_text) %>% \n  mutate(text_full = str_split(os_text, pattern = '\\\\n')) %>% \n  unnest(text_full) %>% \n  mutate(text_full = str_trim(text_full))\n\n```\n\n```{r, warning=FALSE}\nos_df <- os_tidy %>% \n  slice(-(1:184)) %>% \nmutate(chapter = case_when(\n     str_detect(text_full, \"CHAPTER\") ~ str_extract(text_full, \"CHAPTER [1-9]+\"),\n     TRUE ~ NA_character_\n   )) %>% \n  fill(chapter) %>% \n  separate(col = chapter, into = c(\"cha\", \"no\"), sep = \" \") %>% \n  mutate(chapter = as.numeric(no))\n```\n\n### Word count by Chapter\n\n```{r, warning=FALSE}\nos_tokens <- os_df %>% \n  unnest_tokens(word, text_full) %>% \n  select(-os_text) \n\nos_tokens_clean <- os_tokens %>%\n   mutate(word = str_replace(word, \"[0-9-]+\", NA_character_)) %>% \n  drop_na()\n\nos_wordcount <- os_tokens_clean %>% \n  count(chapter, word) \n```\n\n### Remove stop words and recounting again\n\n```{r, warning=FALSE}\nos_nonstop_words <- os_tokens_clean %>% \n  anti_join(stop_words)\n\nnonstop_counts <- os_nonstop_words %>% \n  count(chapter, word) \n  \n```\n\n### Top 5 words by chapter\n\n```{r, warning=FALSE}\ntop_5_words <- nonstop_counts %>% \n  group_by(chapter) %>% \n  arrange(-n) %>% \n  slice(1:5)\n\nch_names <- list(\n  \"1\" =\"Chapter 1\",\n  \"2\" = \"Chapter 2\",\n  \"3\" = \"Chapter 3\",\n  \"4\" = \"Chapter 4\",\n  \"5\" = \"Chapter 5\",\n  \"6\" = \"Chapter 6\",\n  \"7\" = \"Chapter 7\",\n  \"8\" = \"Chapter 8\",\n  \"9\" = \"Chapter 9\",\n  \"10\" = \"Chapter 10\",\n  \"11\" = \"Chapter 11\",\n  \"12\" = \"Chapter 12\",\n  \"13\" = \"Chapter 13\",\n  \"14\" = \"Chapter 14\",\n  \"15\" = \"Chapter 15\"\n )\n\nch_labeller <- function(variable,value){\n  return(ch_names[value])\n}\n\n## vizualization\nggplot( data = top_5_words,\n        aes(reorder(word, n), n )) +\n  geom_col(fill = \"forestgreen\") +\n  facet_wrap(~chapter, scales = \"free\", labeller=ch_labeller) +\n  coord_flip() +\n  theme_minimal() +\n  labs(x = \"Word\", y = \" Count\")\n```\n\n### Word cloud for all text\n\n```{r, warning=FALSE}\nnonstop_counts_full <- os_nonstop_words %>% \n  count(word) \n\nos_top100_removesps <- nonstop_counts_full %>% \n  arrange(-n) %>% \n  slice(1:100)\n\nos_cloud <- ggplot(data = os_top100_removesps, aes(label = word)) +\n  geom_text_wordcloud(aes(color = n, size = n), shape = \"circle\") +\n  scale_size_area(max_size = 10) +\n  scale_color_gradient(low = \"darkseagreen\", high = \"forestgreen\") +\n  theme_minimal()\n\nos_cloud\n\n#ggsave(here(\"src\",\"originofspecies-wc-ea.png\"), width = 8, height = 5) # to save\n```\n\n### Sentiment analysis using \"NRC\" lexicon\n\n```{r, warning=FALSE}\n## nrc to just check out\nos_nrc <- os_nonstop_words %>% \n  inner_join(get_sentiments(\"nrc\"))\n\nos_nrc_counts <- os_nrc %>% \n  count(chapter, sentiment)\n\nos_nrc_viz<- ggplot(data = os_nrc_counts, aes(x = sentiment, y = n)) +\n  geom_col() +\n  facet_wrap(~chapter, labeller=ch_labeller) + # ch_labeller function defined in steps above \n  coord_flip() +\n  theme_minimal(base_size = 14) +\n  theme(axis.title.y = element_text(margin = margin(t = 20, r = 0, b = 0, l = 20))) + \n  labs(y = \"Word Count\", x = \"NRC sentiment\", title = \"Sentiment analysis of the Origin of Species by Charles Darwin \\nusing NRC from Saif Mohammad and Peter Turney\") \n\nggsave(\"origin-of-species-nrc-analysis.png\", os_nrc_viz, width = 12, height = 8, units = \"in\", dpi = 300)\n```\n\n![](origin-of-species-nrc-analysis.png)\n\n### Citations:\n\n-   NRC lexicon: Crowdsourcing a Word-Emotion Association Lexicon, Saif Mohammad and Peter Turney, Computational Intelligence, 29 (3), 436-465, 2013.\n-   [Origin of Species Text](https://laurieximenez.files.wordpress.com/2019/04/the-origin-of-species_charles-darwin.pdf)\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"text-wrangling-and-analysis.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.475","editor":"visual","theme":{"light":["cosmo","../../ember.scss"],"dark":["darkly","../../ember.scss"]},"title-block-banner":true,"title":"Text wrangling and analysis","description":"Counts and visualizations for the most frequently used words in \"The Origin of Species\" by Charles Darwin, 6th Edition.\n","author":[{"name":"Elmera Azadpour"}],"date":"2021-02-23","categories":["code","text analysis","visualization"],"image":"wordcloud.jpg"},"extensions":{"book":{"multiFile":true}}}}}